<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ì˜ì–´ ë™ì•„ë¦¬ ì‹¤ì‹œê°„ í˜„í™©íŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ì‹œìŠ¤í…œì—ì„œ ì œê³µ)
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'english-study-club';
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // ìƒíƒœ ê´€ë¦¬
        let studyData = {};
        const members = ["ì´ì„±ë¯¸", "í™©ê²½í˜œ", "ê¹€ìœ¤í¬", "ë°±ê°€í¬"];

        // ì¸ì¦ ë° ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
        async function init() {
            await signInAnonymously(auth);
            
            // ì‹¤ì‹œê°„ ë°ì´í„° êµ¬ë…
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'progress');
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    studyData = docSnap.data();
                } else {
                    // ì´ˆê¸° ë°ì´í„° êµ¬ì¡° ìƒì„±
                    members.forEach(m => { studyData[m] = []; });
                }
                render();
            }, (error) => console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error));
        }

        // í™”ë©´ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function render() {
            const container = document.getElementById('members-container');
            container.innerHTML = '';
            
            members.forEach(name => {
                const data = studyData[name] || [];
                const filledCount = data.length;
                
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-xl border border-slate-200 shadow-sm";
                
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <span class="font-bold text-lg text-slate-700">${name}</span>
                            <span class="text-sm font-medium ${filledCount === 20 ? 'bg-green-500 text-white' : 'bg-blue-50 text-blue-600'} px-2 py-1 rounded-full">
                                ${filledCount === 20 ? 'ğŸ‰ ì™„ì£¼!' : filledCount + '/20 ì™„ë£Œ'}
                            </span>
                        </div>
                    </div>
                    <div class="w-full bg-slate-100 h-2 rounded-full mb-4 overflow-hidden">
                        <div class="bg-blue-500 h-full transition-all duration-500" style="width: ${(filledCount / 20) * 100}%"></div>
                    </div>
                    <div class="grid grid-cols-5 md:grid-cols-10 gap-2">
                        ${Array.from({length: 20}).map((_, i) => {
                            const dateValue = data[i] || '';
                            const isFilled = !!dateValue;
                            return `
                                <div onclick="window.toggleSlot('${name}', ${i})" 
                                     class="h-12 flex items-center justify-center border-2 rounded-lg cursor-pointer transition-all text-[10px] font-bold
                                     ${isFilled ? 'bg-blue-500 border-blue-600 text-white' : 'bg-white border-slate-100 text-slate-300 hover:border-slate-300'}">
                                    ${isFilled ? dateValue : i + 1}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // í´ë¦­ ì‹œ ë°ì´í„° ì—…ë°ì´íŠ¸
        window.toggleSlot = async (name, index) => {
            const currentData = [...(studyData[name] || [])];
            
            if (currentData[index]) {
                if (confirm("ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
                    currentData.splice(index, 1);
                }
            } else {
                const now = new Date();
                const dateStr = `${now.getMonth() + 1}/${now.getDate()}`;
                currentData.push(dateStr);
            }

            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'progress');
            await setDoc(docRef, { ...studyData, [name]: currentData });
        };

        window.onload = init;
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto space-y-6">
        <div class="bg-slate-800 p-8 rounded-2xl text-white text-center shadow-lg">
            <h1 class="text-2xl font-bold mb-2">ğŸ“š 2026 ì˜ì–´ ë™ì•„ë¦¬ ì‹¤ì‹œê°„ ê¸°ë¡ë¶€</h1>
            <p class="text-slate-400 text-sm">ëˆ„êµ¬ë‚˜ ìì‹ ì˜ ì¹¸ì„ í´ë¦­í•´ ë‚ ì§œë¥¼ ê¸°ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div id="members-container" class="space-y-6">
            <!-- ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ ì¤‘... -->
            <div class="text-center py-20 text-slate-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</div>
        </div>

        <div class="bg-blue-50 border border-blue-100 p-5 rounded-xl text-sm text-blue-800">
            <ul class="space-y-2">
                <li>â€¢ <b>ê¸°ë¡ ë°©ë²•:</b> ìì‹ ì˜ ì´ë¦„ ì•„ë˜ ìˆ«ìë¥¼ ëˆ„ë¥´ë©´ ì˜¤ëŠ˜ ë‚ ì§œê°€ ì°í™ë‹ˆë‹¤.</li>
                <li>â€¢ <b>ì‚­ì œ ë°©ë²•:</b> ì…ë ¥ëœ ë‚ ì§œë¥¼ ë‹¤ì‹œ ëˆ„ë¥´ë©´ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li>â€¢ <b>ì£¼ì˜:</b> ë‹¤ë¥¸ ì‚¬ëŒì˜ ì¹¸ì€ ì‹¤ìˆ˜ë¡œ ëˆ„ë¥´ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì£¼ì„¸ìš”!</li>
            </ul>
        </div>
    </div>
</body>
</html>


